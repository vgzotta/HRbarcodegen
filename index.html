<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EAN‑13 Barcode Generator — High‑Resolution</title>
  <meta name="description" content="Generate and download high‑resolution EAN‑13 barcodes as PNG or SVG. Validates check digit. 100% client‑side." />
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0f172a">
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827ee;
      --card: #0b1220;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #60a5fa;
      --accent-2: #a78bfa;
      --danger: #fca5a5;
    }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 10% 10%, #0b1220, #0f172a);
      color: var(--text);
    }
    .wrap { max-width: 1100px; margin: 40px auto; padding: 0 16px; }
    .hero { display:flex; align-items:center; justify-content:space-between; gap: 24px; flex-wrap: wrap; }
    .title { font-size: clamp(28px, 3.4vw, 44px); line-height: 1.05; font-weight: 800; letter-spacing: -0.02em; }
    .subtitle { color: var(--muted); margin-top: 6px; }
    .panel { background: linear-gradient(180deg, #0d1526, #0b1220); border: 1px solid rgba(148,163,184,.12); border-radius: 18px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
    .grid { display:grid; grid-template-columns: 1.2fr .8fr; gap: 18px; }
    @media (max-width: 920px){ .grid { grid-template-columns: 1fr; } }
    label { font-size: 12px; text-transform: uppercase; letter-spacing: .08em; color: var(--muted); display:block; margin-bottom: 6px; }
    input[type="text"], input[type="number"], select {
      width: 100%; box-sizing: border-box; background: #0b1220; color: var(--text); border: 1px solid rgba(148,163,184,.18); border-radius: 12px; padding: 12px 14px; outline: none; font-size: 16px;
    }
    input:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(96,165,250,.25); }
    .row { display:grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
    .btns { display:flex; gap: 10px; flex-wrap: wrap; }
    button { cursor:pointer; border: none; border-radius: 12px; padding: 12px 16px; font-weight: 700; font-size: 15px; color: #0b1220; background: linear-gradient(135deg, var(--accent), var(--accent-2)); box-shadow: 0 8px 18px rgba(99,102,241,.35); }
    button.secondary { background: transparent; color: var(--text); border: 1px solid rgba(148,163,184,.25); box-shadow: none; }
    .small { font-size: 12px; color: var(--muted); }
    .preview-card { border-radius: 18px; padding: 18px; background: #020617; border: 1px solid rgba(148,163,184,.12); }
    .error { color: var(--danger); font-weight: 600; }
    .note { font-size: 12px; color: var(--muted); margin-top: 8px; }
    canvas { width: 100%; height: auto; background: white; border-radius: 12px; }
    .kbd { background:#111827; border:1px solid #1f2937; border-bottom-width: 3px; padding:2px 6px; border-radius:6px; font-weight:700; }
    .footer { margin-top: 18px; color: var(--muted); font-size: 12px; display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .chip { border: 1px solid rgba(148,163,184,.25); border-radius: 999px; padding: 6px 10px; font-size: 12px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div>
        <div class="title">EAN‑13 Barcode Generator</div>
        <div class="subtitle">High‑resolution PNG or crisp, printable SVG. Offline, single‑file, no dependencies.</div>
      </div>
    </div>

    <div class="grid" style="margin-top:22px;">
      <div class="panel">
        <div class="row">
          <div>
            <label for="inputDigits">Digits (12 or 13)</label>
            <input id="inputDigits" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="e.g. 590123412345" />
            <div class="note">Enter 12 digits to auto‑compute the check digit, or 13 to validate.</div>
          </div>
          <div>
            <label for="barWidth">Module width (px)</label>
            <input id="barWidth" type="number" min="1" step="1" value="3" />
            <div class="note">Controls overall width and resolution.</div>
          </div>
          <div>
            <label for="barHeight">Bar height (px)</label>
            <input id="barHeight" type="number" min="40" step="1" value="180" />
            <div class="note">Height of the bars (excl. text).</div>
          </div>
        </div>

        <div class="row" style="margin-top:12px;">
          <div>
            <label for="quiet">Quiet zone (modules)</label>
            <input id="quiet" type="number" min="11" value="11" />
          </div>
          <div>
            <label for="fontSize">Text size (px)</label>
            <input id="fontSize" type="number" min="8" value="28" />
          </div>
          <div>
            <label for="format">Download format</label>
            <select id="format">
              <option value="png">PNG (raster)</option>
              <option value="svg">SVG (vector)</option>
            </select>
          </div>
        </div>

        <div style="margin-top:16px;" class="btns">
          <button id="btnRender">Generate</button>
          <button id="btnDownload" class="secondary">Download</button>
          <button id="btnSample" class="secondary">Try sample</button>
        </div>

        <div id="status" class="note" style="margin-top:10px"></div>
      </div>

      <div class="preview-card">
        <canvas id="canvas" width="1200" height="260" aria-label="Generated EAN-13 barcode preview"></canvas>
        <div class="footer">
          <span class="chip">Output width: <span id="outW">—</span> px</span>
          <span class="chip">Check digit: <span id="outCheck">—</span></span>
          <span class="chip">Parity set: <span id="outParity" class="mono">—</span></span>
          <span class="chip">Spec: EAN‑13</span>
        </div>
      </div>
    </div>

    <div class="panel" style="margin-top:18px;">
      <div style="font-weight:700; margin-bottom:8px;">Tips</div>
      <ul class="small" style="margin:0; padding-left:18px; line-height:1.7;">
        <li>Minimum quiet zone is 11 modules on both sides. Keep backgrounds white and high contrast for reliable scanning.</li>
        <li>For packaging/print, prefer <span class="kbd">SVG</span> or export a large <span class="kbd">PNG</span> (increase module width) and scale down in your DTP app.</li>
        <li>EAN‑13 structure: <span class="mono">L‑guard 101</span>, left 6 digits (mixed <span class="mono">L/G</span> parity), <span class="mono">center 01010</span>, right 6 digits (<span class="mono">R</span> parity), <span class="mono">R‑guard 101</span>.</li>
      </ul>
    </div>
  </div>

<script>
// EAN‑13 encoding tables
const L = {0:"0001101",1:"0011001",2:"0010011",3:"0111101",4:"0100011",5:"0110001",6:"0101111",7:"0111011",8:"0110111",9:"0001011"};
const G = {0:"0100111",1:"0110011",2:"0011011",3:"0100001",4:"0011101",5:"0111001",6:"0000101",7:"0010001",8:"0001001",9:"0010111"};
const R = {0:"1110010",1:"1100110",2:"1101100",3:"1000010",4:"1011100",5:"1001110",6:"1010000",7:"1000100",8:"1001000",9:"1110100"};
const PARITY = {0:"LLLLLL",1:"LLGLGG",2:"LLGGLG",3:"LLGGGL",4:"LGLLGG",5:"LGGLLG",6:"LGGGLL",7:"LGLGLG",8:"LGLGGL",9:"LGGLGL"};

function computeCheck12(d12){
  let sum = 0;
  for(let i=0;i<12;i++){ const n=+d12[i]; sum += (i%2===0) ? n : 3*n; }
  return (10 - (sum % 10)) % 10;
}
function encodeEAN13(digits){
  if(!/^\d{12,13}$/.test(digits)) throw new Error("Input must be 12 or 13 digits");
  if(digits.length===12){ digits += computeCheck12(digits); }
  else { const exp=computeCheck12(digits.slice(0,12)); if(exp!==+digits[12]) throw new Error(`Invalid check digit. Expected ${exp}.`); }
  const lead=+digits[0]; const parity=PARITY[lead];
  let left=""; for(let i=1;i<=6;i++){ const p=parity[i-1]; const n=+digits[i]; left += (p==='L'?L[n]:G[n]); }
  let right=""; for(let i=7;i<=12;i++){ right += R[+digits[i]]; }
  const full="101"+left+"01010"+right+"101";
  return { bits: full, normalized: digits, parity };
}
function drawToCanvas(bits, opts){
  const { moduleWidth, barHeight, quiet, text, fontSize } = opts;
  const guardExtra = Math.round(barHeight*0.07);
  const totalModules = quiet + bits.length + quiet;
  const width = totalModules * moduleWidth;
  const textSpace = fontSize + Math.round(fontSize*0.4);
  const height = barHeight + textSpace + 12;
  const canvas = document.getElementById('canvas'); canvas.width = width; canvas.height = height;
  const ctx = canvas.getContext('2d');
  ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,width,height); ctx.fillStyle = '#000000';
  const guardIdx = new Set([0,1,2, 45,46,47,48,49, 92,93,94]);
  let x = quiet * moduleWidth;
  for(let i=0;i<bits.length;i++){ const bit = bits[i]; if(bit==='1'){ const h = guardIdx.has(i) ? barHeight + guardExtra : barHeight; ctx.fillRect(x, 10, moduleWidth, h); } x += moduleWidth; }
  ctx.fillStyle = '#000000'; ctx.textAlign = 'center'; ctx.textBaseline = 'alphabetic'; ctx.font = `${fontSize}px system-ui, -apple-system, Segoe UI, Roboto, Arial`;
  const d = text; const baseY = barHeight + guardExtra + 10 + fontSize;
  ctx.textAlign = 'right'; ctx.fillText(d[0], quiet * moduleWidth - Math.round(moduleWidth*1.5), baseY);
  ctx.textAlign = 'center'; const leftStart = quiet * moduleWidth + 3*moduleWidth; const leftWidth = 42 * moduleWidth;
  for(let i=1;i<=6;i++){ const cx = leftStart + (i-0.5) * (7*moduleWidth); ctx.fillText(d[i], cx, baseY); }
  const rightStart = leftStart + leftWidth + 5*moduleWidth;
  for(let i=7;i<=12;i++){ const cx = rightStart + (i-6-0.5) * (7*moduleWidth); ctx.fillText(d[i], cx, baseY); }
  return { width, height };
}
function buildSVG(bits, opts){
  const { moduleWidth, barHeight, quiet, text, fontSize } = opts;
  const guardExtra = Math.round(barHeight*0.07);
  const totalModules = quiet + bits.length + quiet;
  const width = totalModules * moduleWidth;
  const textSpace = fontSize + Math.round(fontSize*0.4);
  const height = barHeight + guardExtra + textSpace + 22;
  const guardIdx = new Set([0,1,2, 45,46,47,48,49, 92,93,94]);
  let x = quiet * moduleWidth; let rects = [];
  for(let i=0;i<bits.length;i++){ if(bits[i]==='1'){ const h = guardIdx.has(i) ? barHeight + guardExtra : barHeight; rects.push(`<rect x="${x}" y="10" width="${moduleWidth}" height="${h}" fill="#000"/>`);} x += moduleWidth; }
  const d = text; const baseY = barHeight + guardExtra + 10 + fontSize; const leftStart = quiet * moduleWidth + 3*moduleWidth; const leftWidth = 42 * moduleWidth; const rightStart = leftStart + leftWidth + 5*moduleWidth;
  const t = [
    `<text x="${quiet*moduleWidth - Math.round(moduleWidth*1.5)}" y="${baseY}" text-anchor="end" font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial" font-size="${fontSize}">${d[0]}</text>`,
    ...Array.from({length:6}, (_,i)=>{ const cx = leftStart + (i+0.5)*(7*moduleWidth); return `<text x="${cx}" y="${baseY}" text-anchor="middle" font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial" font-size="${fontSize}">${d[i+1]}</text>`;}),
    ...Array.from({length:6}, (_,i)=>{ const cx = rightStart + (i+0.5)*(7*moduleWidth); return `<text x="${cx}" y="${baseY}" text-anchor="middle" font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial" font-size="${fontSize}">${d[i+7]}</text>`;})
  ];
  const svg = `<?xml version="1.0" encoding="UTF-8"?>\n`+`<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}" viewBox="0 0 ${width} ${height}">\n`+`<rect width="100%" height="100%" fill="#fff"/>\n`+rects.join('\n') + '\n' + t.join('\n') + '\n</svg>';
  return { svg, width, height };
}
const input = document.getElementById('inputDigits');
const barWidth = document.getElementById('barWidth');
const barHeight = document.getElementById('barHeight');
const quiet = document.getElementById('quiet');
const fontSize = document.getElementById('fontSize');
const formatSel = document.getElementById('format');
const btnRender = document.getElementById('btnRender');
const btnDownload = document.getElementById('btnDownload');
const btnSample = document.getElementById('btnSample');
const status = document.getElementById('status');
const outW = document.getElementById('outW');
const outChk = document.getElementById('outCheck');
const outParity = document.getElementById('outParity');
let last = null;
btnSample.addEventListener('click', () => { input.value = '590123412345'; render(); });
btnRender.addEventListener('click', render);
btnDownload.addEventListener('click', download);
function render(){
  const raw = (input.value||'').replace(/\s+/g,'');
  status.textContent = '';
  try{
    const { bits, normalized, parity } = encodeEAN13(raw);
    const m = parseInt(barWidth.value||'3',10);
    const h = parseInt(barHeight.value||'180',10);
    const q = parseInt(quiet.value||'11',10);
    const f = parseInt(fontSize.value||'28',10);
    const { width, height } = drawToCanvas(bits, { moduleWidth: m, barHeight: h, quiet: q, text: normalized, fontSize: f });
    outW.textContent = width;
    outChk.textContent = normalized[12];
    outParity.textContent = parity;
    last = { bits, normalized, parity, width, height, opts:{ moduleWidth:m, barHeight:h, quiet:q, fontSize:f } };
  }catch(e){
    status.innerHTML = `<span class="error">${e.message}</span>`;
    last = null;
  }
}
function download(){
  if(!last){ status.innerHTML = '<span class="error">Generate a barcode first.</span>'; return; }
  const fmt = formatSel.value;
  if(fmt==='png'){
    const link = document.createElement('a');
    link.download = `${last.normalized}.png`;
    link.href = document.getElementById('canvas').toDataURL('image/png');
    link.click();
  } else {
    const { svg } = buildSVG(last.bits, { ...last.opts, text:last.normalized });
    const blob = new Blob([svg], {type:'image/svg+xml'});
    const link = document.createElement('a');
    link.download = `${last.normalized}.svg`;
    link.href = URL.createObjectURL(blob);
    link.click();
    setTimeout(()=>URL.revokeObjectURL(link.href), 1000);
  }
}
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => navigator.serviceWorker.register('service-worker.js'));
}
window.addEventListener('DOMContentLoaded', () => { input.value = '590123412345'; render(); });
</script>
</body>
</html>
